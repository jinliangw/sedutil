.\" Manpage for sedutil-cli.
.TH SEDUTIL\-CLI 8 "29 Dec 2021" "1.16" "sedutil-cli man page"
.SH NAME
sedutil-cli \- util to manage TCG Storage self encrypting drives

.SH SYNOPSIS
sedutil\-cli [\-vnlx] [\-c=x] [\-t=n] [\-a=n] [\-ds=x,y,z] <action> <options> <device>

.SH DESCRIPTION
sedutil-cli is a utility to manage self encrypting drives that conform
to the Trusted Computing Group (TCG) Enterprise, Opal, Ruby, Opalite and
Pyrite SSC specifications.

For SATA drives in Linux, libata.allow_tpm must be set to 1. Either via adding
libata.allow_tpm=1 to the kernel flags at boot time or changing the
contents of /sys/module/libata/parameters/allow_tpm to a from a
"0" to a "1" on a running system.

.SH OPTIONS
.SS General Options
.TP
.IP "\-v (optional)"
increase verbosity, one to five v's
.IP "\-n (optional)"
no password hashing. Passwords will be sent in clear text!
.IP "\-l (optional)"
log style output to stderr only
.IP "\-x (optional)
use a transaction for the operation
.IP "\-c=comID (optional)
select a comID value, offset from base (-c=+1) or absolute (-c=0x1000).
.IP "\-t=n (optional)"
set session timeout value, n is in milliseconds
.IP "\-a=authority (optional)"
over-ride the default authority. authority options Admin<1..n>, User<1..n>. This option is not supported by all commands.
.IP "\-ds=x,y,z (optional)"
optionally used with activate commands. Set the Datastore tables sizes.  1 to n size values comma separated (no spaces).

.SS Actions

.SS Universal
.IP \-\-scan
Scans the devices on the system identifying TCG compliant devices
.IP "\-\-query <device>"
Display the Discovery 0 response of a device
.IP "\-\-isValidSED <device>"
Verify whether the given device is SED or not
.IP "\-\-listLockingRanges <password> <device>"
List all Locking Ranges.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-listLockingRange <0...n> <password> <device>"
List an individual Locking Range, 0 = GLobal 1..n = LRn. Default authority is Admin1, over-ride with -a option.
.IP "\-\-rekeyLockingRange <0...n> <password> <device>"
Rekey a Locking Ranges, 0 = GLobal 1..n = LRn.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-setupLockingRange <0...n> <RangeStart> <RangeLength> <password> <device>"
Setup a new Locking Range, 0 = GLobal 1..n = LRn.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-initialSetup <SIDpassword> <device>"
Setup the device for use with sedutil, <SIDpassword> is new SID and Admin1 password (Opal) or the EraseMaster and all BandMasters (Enterprise).
.IP "\-\-setSIDPassword <SIDpassword> <newSIDpassword> <device>"
Change the SID password
.IP "\-\-takeOwnership <newSIDpassword> <device>" 
Change the SID password using the MSID password
.IP "\-\-setPassword <oldpassword> <userid> <newpassword> <device>"
Change the password of an authority. For Enterprise, userid = "EraseMaster" or "BandMaster<n>", 0 <= n <= 1023. For Opal, userid = Admin<n> or User<n>.  oldpassword = "" for MSID. Default authority is Admin1, over-ride with -a option.  Default SP is Locking, over-ride with -sp option.
.IP "\-\-setLockingRange <0...n> <RW|RO|WO|LK|+R|-R> <password> <device>"
Set the status of a Locking Range, 0 = GLobal 1..n = LRn.  Options for read/write enabled, read only, write only, locked, or add or remove Programmatic Reset effect. Default authority is Admin1, over-ride with -a option.
.IP "\-\-enableLockingRange <0...n> <password> <device>"
Enable a Locking Range, 0 = GLobal 1..n = LRn.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-disableLockingRange <0...n> <Admin1password> <device>"
Disable a Locking Range, 0 = GLobal 1..n = LRn.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-revertTPer <password> <device>"
Set the device back to factory defaults.  Default authority is SID, over-ride with -a option.
.B This **ERASES ALL DATA**
.IP "\-\-revertSP <SP> <authority> <password> <keep> <device>"
Set a security protocol to factory defaults.  SP is Admin or Locking, authority is SID or Admin[1..n], keep = T or F (keep the global locking range key)
.B This **ERASES ALL DATA** except that protoected by the Global Range key is keep is T.
.IP "\-\-revertLockingSP <Admin1password> <device>"
Deactivate the Locking SP and erase all of the data.
.IP "\-\-revertNoErase <Admin1password> <device>"
Deactivate the Locking SP without erasing the data on GLOBAL RANGE *ONLY*
.IP "\-\-PSIDrevert <PSID> <device>"
.IP "\-\-yesIreallywanttoERASEALLmydatausingthePSID <PSID> <device>"
Revert the device using the PSID.
.B *ERASING* *ALL* the data
.IP "\-\-PSIDrevertAdminSP <PSID> <device>"
Alike to PSIDrevert, but on Enterprise calls AdminSP->Revert instead of
ThisSP->RevertSP.  There are no PSID or Revert standards for Enterprise
and different devices support different methods.
.IP "\-\-printDefaultPassword <device>"
print MSID

.SS TCG Opal devices only
.IP "\-\-setAdmin1Pwd <Admin1password> <newAdmin1password> <device>"
Change the Admin1 password
.IP "\-\-activateLockingSP <SIDpassword> <device>"
Activate the LockingSP. Admin1 password in LockingSP will be set to SID password.
.IP "\-\-enableUser <password> <user> <device>"
Enable a user is Admin[1..n] or User[1..n].  Default SP is Locking, over-ride with -sp option.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-setMBREnable <on|off> <Admin1password> <device>"
Enable|Disable MBR shadowing
.IP "\-\-setMBRDone <on|off> <Admin1password> <device>"
set|unset MBRDone
.IP "\-\-loadPBAimage <Admin1password> <file> <device>"
Write <file> to MBR Shadow area
.IP "\-\-readMBR <Admin1Password> <offset> <count> <device>"
Print MBR data starting at offset for count bytes.
.IP "\-\-loadDataStore <Admin1password> <table> <offset> <count> <file> <device>"
Load data from a file into the Datastore table.  count is maxiumum bytes to write, 0 for whole file. 
table selects the DataStore table, 1 if no additional tables.
.IP "\-\-readDataStore <Admin1password> <table> <offset> <count> <device>"
Print DataStore data starting at offset for count bytes.  table selects the DataStore table, 1 if no additional tables.
.IP "\-\-assign <Admin1Password> <namespace> <rangeStart> <rangeLength> <device>"
Assign a locking range for a namespace (CNL feature).  Default authority is Admin1, over-ride with -a option.
.IP "\-\-deassign <Admin1password> <1...n> <keep> <device>"
Deassign a Locking Range (CNL feature). 1...n - LRn, keep = T or F.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-printTables <SP> <password> <level> <device>"
Get and print all of the accessible table values and ACL for a Security Protocol.  SP is Admin or Locking.  
Use Admin1 password for LockingSP, SID password or "" for MSID for AdminSP.  level 0 is tables only, 1 tables and ACL, 2 for details, 3 for debug.
.IP "\-\-enableTperReset <SIDpassword> <D|E> <device>"
Enable or disable TPer Reset. D = disable, E = enable.
.IP "\-\-tperReset <device>"
Send a TPER_RESET request to device.
.IP "\-\-stackReset <device>"
Send a STACK_RESET for the base ComID.
.IP "\-\-getACE <halfUID> <password> <device>"
Print the ACE table boolean expression for the row specified by the halfUID value (lower half of row UID). Default SP is Locking, over-ride with -sp option.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-setACE <halfUID> <expression> <password> <device>"
Set the ACE table boolean expression (UID) for the row specified by the halfUID value (lower half of row UID). Expression is Anybody, SID, PSID, Admins, Admin[1..n], User[1..n]. Default SP is Locking, over-ride with -sp option.  Default authority is Admin1, over-ride with -a option.
.IP "\-\-getRandom <size> <password> <device>"
Get a random number of <size> bytes.  Default SP is Admin, over-ride with -sp option.  Default authority is Anybody (password is ignored), over-ride with -a option.

.SS TCG Opal devices in Single User Mode only
.IP "\-\-setup_SUM <0...n> <lrstart> <lrlength> <password> <newpassword> <device>"
Initial setup for the device in TCG Opal Single User Mode.  Selects Global range (0) or a single range (1..n).  
lrstart and lrlength are ignored got global range. password in the SID password, User<n+1> password will be set to newpassword.
.IP "\-\-activateLockingSP_SUM <x,y,z> <policy> <SIDpassword> <device>"
Activate the LockingSP in Single User Mode on all ranges (-1) or a comma separated list of ranges (0,4,8,10).
policy is the RangeStartLengthPolicy, 0 for User, 1 for Admin.
Admin1 password in LockingSP will be set to SID password.
.IP "\-\-setPassword_SUM <password> <user> <newpassword> <device>"
Change the password of a TCG Opal User authority. user = User1, User2, ...  Default User passwords are "".
.IP "\-\-eraseLockingRange_SUM <0...n> <password> <device>"
Erase a Locking Range, 0 = GLobal 1..n = LRn.  password is for the User<n> that owns the Locking Range.
.IP "\-\-setLockingRange_SUM <0...n> <RW|RO|WO|LK> <password> <device>"
Set the locking status of a Locking Range, 0 = GLobal 1..n = LRn.  password is for the User<n> that owns the Locking Range.
.IP "\-\-setupLockingRange_SUM <0...n> <RangeStart> <RangeLength> <password> <device>"
Setup a new Locking Range, 0 = GLobal 1..n = LRn.  password is for the User<n> that owns the Locking Range.
.IP "\-\-enableLockingRange_SUM <0...n> <RW|R|W|D> <password> <device>"
Set the ReadLockEnable and WriteLockEnable state for a LockingRange, 0 = Global, 1..n = LRn.  password is for the User<n> that owns the Locking Range
.IP "\-\-assign_SUM <Admin1Password> <namespace> <rangeStart> <rangeLength> <device>"
Assign a locking range for a namespace (CNL feature) using AssignToSUMRange option.  Default authority is Admin1, over-ride with -a option.

.SS TCG Enterprise devices only 
.IP "\-\-setBandsEnabled <password> <device>"
Set Enabled for all Locking Ranges (Enterprise only), password = "" for MSID.
.IP "\-\-setBandEnabled <0...n> <password> <device>"
Set Enabled for Locking Range[n] (Enterprise only), password = "" for MSID.
.IP "\-\-eraseLockingRange <0...n> <password> <device>"
Erase a Locking Range, 0 = GLobal 1..n = LRn

.SH EXAMPLES
.EX
sedutil-cli --scan
.EE
.EX
sedutil-cli --query /dev/sdc
.EE
.EX
sedutil-cli --yesIreallywanttoERASEALLmydatausingthePSID <PSIDNODASHED> /dev/sdc
.EE
.EX
sedutil-cli --initialSetup <newSIDpassword> /dev/sdc
.EE

.SH BUGS
Sleep (S3) is not supported.

.SH AUTHOR
The tool was developed by Bright Plaza Inc. <drivetrust@drivetrust.com>. This man page was written by Jan Luca Naumann <j.naumann@fu-berlin.de>.
